# 04 算数問題集

算数スキルの詳細な問題生成ルール定義。

---

## 0. 目次

- [1. 問題生成基本原則](#1-問題生成基本原則)
- [2. スキル別生成ルール](#2-スキル別生成ルール)
- [3. 答えの正規化ルール](#3-答えの正規化ルール)
- [4. データ構造（問題定義）](#4-データ構造問題定義)

---

## 0. この仕様書の位置づけ

このドキュメントは、**算数の問題データ（コンテンツ）**を定義する。
スキル一覧や入力UI仕様は [02_math_skills.md](./02_math_skills.md) を参照。

---

## 1. 問題生成基本原則

- 問題はスキルごとに毎回ランダム生成する（固定の問題リストは持たない）。
- 答えが負の数になる問題は出さない。
- 答えが出題範囲（桁数など）を不自然に超える問題は出さない。

---

## 2. スキル別生成ルール

### 数の基礎

| スキル | ID | 出題形式 | 生成ルール |
|---|---|---|---|
| 数を数える（1-10） | count_10 | 🍎×n → ? | n: 1〜10のランダム |
| 数を数える（1-50） | count_50 | ◯の次は？ | 1〜49のランダム |
| 数を数える（1-100） | count_100 | ◯の次は？ | 1〜99のランダム |
| 数の順番 | count_fill | 1,2,◯,4,5 | 穴の位置と周囲の数をランダム |
| 大小比較（1桁） | compare_1d | a ○ b | a,b: 1〜9、a≠b |
| 大小比較（2桁） | compare_2d | a ○ b | a,b: 10〜99、a≠b |

### 足し算

| スキル | ID | 出題形式 | 生成ルール |
|---|---|---|---|
| +1〜+3（1桁） | add_1d_1 | a + b = ? | a: 1〜9、b: 1〜3、a+b≤12 |
| +4〜+10（1桁） | add_1d_2 | a + b = ? | a: 1〜9、b: 4〜10、a+b≤18 |
| 2桁+1桁（繰上なし） | add_2d1d_nc | a + b = ? | a: 10〜99、b: 1〜9、1の位の和<10 |
| 2桁+1桁（繰上あり） | add_2d1d_c | a + b = ? | a: 10〜99、b: 1〜9、1の位の和≥10 |
| 2桁+2桁（繰上なし） | add_2d2d_nc | a + b = ? | a,b: 10〜99、各位の和<10 |
| 2桁+2桁（繰上あり） | add_2d2d_c | a + b = ? | a,b: 10〜99、いずれかの位で繰り上がり |
| 3桁+3桁 | add_3d3d | a + b = ? | a,b: 100〜999 |
| 4桁以上 | add_4d | a + b = ? | a,b: 1000〜9999 |

### 引き算

| スキル | ID | 出題形式 | 生成ルール |
|---|---|---|---|
| 1桁-1桁（繰下なし） | sub_1d1d_nc | a - b = ? | a: 1〜9、b: 1〜a |
| 1桁-1桁（繰下あり） | sub_1d1d_c | a - b = ? | a: 11〜18、b: a-10+1〜9 |
| 2桁-1桁（繰下なし） | sub_2d1d_nc | a - b = ? | a: 10〜99、b≤aの1の位 |
| 2桁-1桁（繰下あり） | sub_2d1d_c | a - b = ? | a: 10〜99、b>aの1の位 |
| 2桁-2桁 | sub_2d2d | a - b = ? | a: 10〜99、b: 10〜a |
| 3桁-3桁 | sub_3d3d | a - b = ? | a: 100〜999、b: 100〜a |
| 4桁以上 | sub_4d | a - b = ? | a: 1000〜9999、b: 1000〜a |

### 掛け算

| スキル | ID | 出題形式 | 生成ルール |
|---|---|---|---|
| 九九（n の段） | mul_99_n | n × m = ? | m: 1〜9のランダム |
| 九九ランダム | mul_99_rand | a × b = ? | a,b: 1〜9のランダム |
| 2桁×1桁 | mul_2d1d | a × b = ? | a: 10〜99、b: 2〜9 |
| 3桁×1桁 | mul_3d1d | a × b = ? | a: 100〜999、b: 2〜9 |
| 2桁×2桁 | mul_2d2d | a × b = ? | a,b: 10〜99 |
| 3桁×2桁 | mul_3d2d | a × b = ? | a: 100〜999、b: 10〜99 |

### 割り算

| スキル | ID | 出題形式 | 生成ルール |
|---|---|---|---|
| 割り切れる（九九逆） | div_99_rev | a ÷ b = ? | b: 1〜9、a: b×(1〜9) |
| 2桁÷1桁（割切） | div_2d1d_exact | a ÷ b = ? | b: 2〜9、a: b×(2〜11)で2桁 |
| 余りあり（商1桁） | div_rem_q1 | a ÷ b = ?...? | b: 2〜9、q: 1〜9、r: 1〜b-1 |
| 余りあり（商2桁） | div_rem_q2 | a ÷ b = ?...? | b: 2〜9、q: 10〜99、r: 1〜b-1 |
| 2桁÷2桁 | div_2d2d_exact | a ÷ b = ? | b: 10〜99、q: 1〜9 |
| 3桁÷1桁 | div_3d1d_exact | a ÷ b = ? | b: 2〜9、a: b×(12〜111) |
| 3桁÷2桁 | div_3d2d_exact | a ÷ b = ? | b: 10〜99、a: b×(2〜9) |

### 小数

| スキル | ID | 出題形式 | 生成ルール |
|---|---|---|---|
| 小数の足し算 | dec_add | a + b = ? | a,b: 0.1〜9.9（小数第1位） |
| 小数の引き算 | dec_sub | a - b = ? | a: 0.1〜9.9、b≤a |
| 小数×整数 | dec_mul_int | a × b = ? | a: 0.1〜9.9、b: 2〜9 |
| 小数÷整数 | dec_div_int | a ÷ b = ? | b: 2〜9、a: 割り切れる小数 |
| 小数×小数 | dec_mul_dec | a × b = ? | a,b: 0.1〜9.9 |
| 小数÷小数 | dec_div_dec | a ÷ b = ? | 割り切れる組み合わせ |

### 分数

| スキル | ID | 出題形式 | 生成ルール |
|---|---|---|---|
| 同分母の足し算 | frac_add_same | a/n + b/n | n: 2〜12、a+b≤n |
| 同分母の引き算 | frac_sub_same | a/n - b/n | n: 2〜12、a>b |
| 異分母の足し算 | frac_add_diff | a/m + b/n | m,n: 2〜6の異なる値 |
| 異分母の引き算 | frac_sub_diff | a/m - b/n | 結果が正になる組み合わせ |
| 帯分数の計算 | frac_mixed | 帯分数 ± 帯分数 | 整数部1〜3、分数部は真分数 |
| 分数×整数 | frac_mul_int | a/b × n | a/b: 真分数、n: 2〜9 |
| 分数÷整数 | frac_div_int | a/b ÷ n | 約分可能な組み合わせ |
| 分数×分数 | frac_mul_frac | a/b × c/d | 真分数同士 |
| 分数÷分数 | frac_div_frac | a/b ÷ c/d | 真分数同士 |

### その他

| スキル | ID | 出題形式 | 生成ルール |
|---|---|---|---|
| 10倍、100倍、1/10 | scale_10x | a × 10 | a: 1〜999 |

---

## 3. 答えの正規化ルール

| ケース | ルール |
|---|---|
| 分数 | 必ず **約分した形** で正解とする |
| 帯分数 | **整数・分子・分母の3枠入力** を基本とする（仮分数はUI的に入力不可の場合あり） |
| 小数 | 末尾の0は省略（1.0 → 1） |

---

## 4. データ構造（問題定義）

```typescript
interface Problem {
  skillId: string;
  question: string;        // 表示用問題文（例："5 + 3 ="）
  answer: string;          // 正解（文字列での正規化値）
  alternateAnswers?: string[]; // 許容される別解
  display: ProblemDisplay; // クライアント描画用ヒント
}

interface ProblemDisplay {
  type: "text" | "counting" | "comparison" | "decimal" | "fraction" | "mixed" | "remainder";
  // typeごとの追加情報（画像の個数、分数の初期表示枠など）
  content?: any;
}
```
